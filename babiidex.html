<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="manifest" href='data:application/manifest+json,{"name":"BaBi | Presentes","short_name":"BaBi","display":"standalone","background_color":"#2a0813","theme_color":"#f472b6"}'>
    <meta name="theme-color" content="#f472b6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BaBi">
    
    <title>BaBi | Presentes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ========================================================
           TEMA PREMIUM: VINHO E ROSA
           ======================================================== */
        :root {
            --bg-base: #2a0813; /* Vinho Escuro Fundo */
            --bg-panel: #3b0c1c; /* Vinho Médio Menu */
            --bg-card: #4a1224; /* Vinho Claro Cards */
            --bg-input: #1f050e; /* Vinho Super Escuro Inputs */
            
            --border-light: rgba(244, 114, 182, 0.15); /* Borda Rosa Translúcida */
            --border-hover: rgba(244, 114, 182, 0.3);
            
            --primary: #f472b6; /* Rosa Principal */
            --primary-hover: #fb7185; /* Rosa Brilhante Hover */
            --primary-glow: rgba(244, 114, 182, 0.25);
            
            --text-main: #ffffff;
            --text-muted: #fbcfe8; /* Texto secundário rosado */
            
            --success: #34d399; /* Verde Suave para Concluído */
            --danger: #ef4444;
            --info: #60a5fa;
            
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { max-width: 100vw; overflow-x: hidden; }

        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-base); color: var(--text-main);
            background-image: linear-gradient(var(--border-light) 1px, transparent 1px), linear-gradient(90deg, var(--border-light) 1px, transparent 1px);
            background-size: 40px 40px; background-position: center top;
            min-height: 100vh; display: flex; user-select: none;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-base); }
        ::-webkit-scrollbar-thumb { background: #4a1224; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* ========================================================
           LAYOUT PRINCIPAL E SIDEBAR
           ======================================================== */
        .dashboard { display: grid; grid-template-columns: 320px 1fr; width: 100%; min-height: 100vh; }

        .sidebar { background-color: var(--bg-panel); border-right: 1px solid var(--border-light); padding: 40px 25px; display: flex; flex-direction: column; gap: 40px; position: sticky; top: 0; height: 100vh; overflow-y: auto; box-shadow: 5px 0 30px rgba(0,0,0,0.5); z-index: 10; }
        
        .profile { text-align: center; }
        .avatar-wrapper { position: relative; width: 100px; height: 100px; margin: 0 auto 15px auto; }
        
        /* LOGO CAIXA DE PRESENTE */
        .avatar-gift { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--primary); background: var(--bg-card); box-shadow: 0 0 25px var(--primary-glow); display: flex; justify-content: center; align-items: center; font-size: 2.8rem; color: var(--primary); }
        
        .level-badge { position: absolute; bottom: -5px; right: 5px; background: var(--primary); color: #2a0813; font-size: 0.75rem; font-weight: 800; padding: 4px 8px; border-radius: 12px; border: 2px solid var(--bg-panel); }
        .profile h2 { font-size: 1.4rem; font-weight: 700; margin-bottom: 5px; }
        .profile span { font-size: 0.85rem; color: var(--text-muted); }

        .form-section h3 { font-size: 1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; color: var(--text-main); font-weight: 600; }
        .form-section h3 i { color: var(--primary); }
        
        input { width: 100%; padding: 14px 16px; margin-bottom: 12px; background: var(--bg-input); border: 1px solid var(--border-light); color: var(--text-main); border-radius: 10px; font-family: 'Inter', sans-serif; font-size: 0.95rem; transition: var(--transition-smooth); outline: none; -webkit-appearance: none; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 1px var(--primary); background: #000; }
        input::placeholder { color: rgba(251, 207, 232, 0.4); } /* Ajuste no placeholder para ficar legível no vinho */
        
        button { width: 100%; padding: 15px; border-radius: 10px; font-family: 'Inter', sans-serif; font-weight: 800; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: var(--transition-smooth); border: none; outline: none; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-theme { background: var(--primary); color: #2a0813; box-shadow: 0 4px 15px var(--primary-glow); }
        .btn-theme:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(244, 114, 182, 0.4); }
        .btn-outline { background: transparent; border: 1px dashed var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary-glow); border-style: solid; transform: translateY(-2px); color: #fff;}
        .btn-dark { background: var(--bg-input); border: 1px solid var(--border-light); color: var(--text-main); }
        .btn-dark:hover { background: var(--bg-base); border-color: var(--primary); transform: translateY(-2px); }

        /* ========================================================
           ÁREA PRINCIPAL
           ======================================================== */
        .main-content { padding: 40px; display: flex; flex-direction: column; gap: 30px; max-width: 1500px; margin: 0 auto; width: 100%; }

        /* PAINEL DE FOCO DIÁRIO */
        .today-panel { background: linear-gradient(145deg, var(--bg-panel), var(--bg-base)); border: 1px solid var(--primary); border-radius: 20px; padding: 30px; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; overflow: hidden; box-shadow: 0 15px 40px var(--primary-glow); }
        .streak-pill { position: absolute; top: 20px; left: 20px; background: rgba(244, 114, 182, 0.15); color: var(--primary); padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; display: flex; align-items: center; gap: 6px; border: 1px solid rgba(244, 114, 182, 0.3); }
        .today-title { color: var(--text-muted); font-size: 0.95rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 5px; margin-top: 15px; }
        .today-earnings { font-size: 3.8rem; font-weight: 800; color: var(--primary); margin: 0; line-height: 1; letter-spacing: -1px; text-shadow: 0 10px 30px var(--primary-glow); }
        .today-tasks { color: var(--text-muted); font-size: 0.95rem; margin-top: 10px; margin-bottom: 25px; }
        
        .daily-progress { width: 100%; max-width: 500px; background: var(--bg-card); height: 8px; border-radius: 4px; overflow: hidden; position: relative; }
        .daily-fill { height: 100%; background: linear-gradient(90deg, #fb7185, #f472b6); border-radius: 4px; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); width: 0%; }
        .daily-labels { width: 100%; max-width: 500px; display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; font-weight: 600; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-light); border-radius: 16px; padding: 25px; display: flex; align-items: center; gap: 20px; word-break: break-word; }
        .icon-box { min-width: 55px; height: 55px; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; flex-shrink: 0; }
        .icon-theme { background: rgba(244, 114, 182, 0.1); color: var(--primary); border: 1px solid rgba(244, 114, 182, 0.2); }
        .icon-green { background: rgba(52, 211, 153, 0.1); color: var(--success); border: 1px solid rgba(52, 211, 153, 0.2); }
        .icon-blue { background: rgba(96, 165, 250, 0.1); color: var(--info); border: 1px solid rgba(96, 165, 250, 0.2); }
        .stat-info span { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; display: block; margin-bottom: 5px; }
        .stat-info h3 { font-size: 1.8rem; font-weight: 700; color: var(--text-main); margin: 0; line-height: 1.1; }

        .panel { background: var(--bg-card); border: 1px solid var(--border-light); border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 100%; overflow: hidden; }
        .panel-header { margin-bottom: 25px; }
        .panel-header h3 { font-size: 1.2rem; display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .panel-header p { color: var(--text-muted); font-size: 0.85rem; }
        .chart-container { position: relative; height: 300px; width: 100%; }

        .bottom-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; align-items: start; width: 100%; }
        .widgets-column { display: flex; flex-direction: column; gap: 25px; width: 100%; }

        /* LISTAS & SWIPE WRAPPER */
        .list { list-style: none; display: flex; flex-direction: column; gap: 12px; width: 100%; }
        .swipe-wrapper { position: relative; border-radius: 12px; overflow: hidden; background: var(--bg-card); }
        .swipe-bg { position: absolute; top: 0; width: 100%; height: 100%; display: flex; align-items: center; padding: 0 25px; font-size: 1.5rem; font-weight: 800; color: white; z-index: 1; }
        .swipe-bg.left { background: var(--success); justify-content: flex-start; left: 0; }
        .swipe-bg.right { background: var(--danger); justify-content: flex-end; right: 0; }

        .list-item { background: var(--bg-panel); border: 1px solid var(--border-light); border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 2; transition: transform 0.2s ease; width: 100%; gap: 15px; }
        .list-item:hover { border-color: var(--border-hover); background: #440d20; }
        .list-item.completing { animation: fadeOutScale 0.4s forwards; }

        .task-info { flex: 1; min-width: 0; }
        .task-info strong { display: block; font-size: 1.05rem; margin-bottom: 8px; font-weight: 600; word-break: break-word; line-height: 1.3; }
        .task-meta { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-muted); flex-wrap: wrap; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; border: 2px solid var(--primary); flex-shrink: 0; }
        .status-dot.completed { border-color: var(--success); background: var(--success); }
        .task-value { color: var(--text-main); font-weight: 700; white-space: nowrap; }

        .actions { display: flex; gap: 8px; flex-shrink: 0; }
        .btn-icon { width: 40px; height: 40px; border-radius: 8px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-light); color: var(--text-muted); display: flex; justify-content: center; align-items: center; cursor: pointer; transition: var(--transition-smooth); font-size: 1.1rem; flex-shrink: 0; }
        .btn-icon.check:hover { background: rgba(52, 211, 153, 0.2); color: var(--success); border-color: var(--success); }
        .btn-icon.delete:hover { background: rgba(239, 68, 68, 0.2); color: var(--danger); border-color: var(--danger); }

        .goal-item { flex-direction: column; align-items: flex-start; gap: 15px; }
        .goal-header { display: flex; justify-content: space-between; width: 100%; align-items: flex-start; gap: 15px; }
        .goal-header-text { flex: 1; min-width: 0; }
        .goal-header-text strong { display: block; font-size: 0.95rem; margin-bottom: 3px; word-break: break-word; }
        .goal-progress-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden; }
        .goal-progress-fill { height: 100%; background: var(--primary); border-radius: 3px; transition: width 1s ease-in-out; }

        /* ========================================================
           FAB & MODAIS (MOBILE)
           ======================================================== */
        .fab { display: none; position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; background: var(--primary); color: #2a0813; border-radius: 35px; justify-content: center; align-items: center; font-size: 1.8rem; box-shadow: 0 0 15px rgba(244, 114, 182, 0.4), 0 0 30px rgba(244, 114, 182, 0.2); z-index: 100; border: none; outline: none; transition: .3s; }
        .fab:active { transform: scale(0.9); }

        .bottom-sheet { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-panel); border-radius: 24px 24px 0 0; padding: 30px 25px; z-index: 200; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 -10px 40px rgba(0,0,0,0.8); border-top: 1px solid var(--border-light); }
        .bottom-sheet.active { transform: translateY(0); display: block; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 150; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(5px); }
        .overlay.active { opacity: 1; pointer-events: auto; }

        .smart-input-container { position: relative; }
        .smart-input { width: 100%; background: var(--bg-input); border: 2px solid var(--border-light); color: white; padding: 20px 50px 20px 20px; border-radius: 16px; font-size: 1.1rem; outline: none; }
        .smart-input:focus { border-color: var(--primary); }
        .submit-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); font-size: 1.5rem; cursor: pointer; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: var(--transition-smooth); padding: 20px; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: var(--bg-card); border: 1px solid var(--border-light); border-radius: 20px; padding: 30px; width: 100%; max-width: 450px; transform: translateY(30px) scale(0.95); transition: var(--transition-smooth); box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); }

        .toast-container { position: fixed; bottom: 30px; right: 30px; left: auto; display: flex; flex-direction: column; gap: 15px; z-index: 9999; }
        .toast { background: var(--bg-panel); border: 1px solid var(--border-light); border-left: 4px solid var(--primary); color: #fff; padding: 16px 20px; border-radius: 12px; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-weight: 500; font-size: 0.9rem; animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards, fadeOut 0.4s ease forwards 4s; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(10px); } }
        @keyframes fadeOutScale { to { opacity: 0; transform: scale(0.95); } }

        /* ========================================================
           RESPONSIVIDADE MOBILE
           ======================================================== */
        @media (max-width: 1200px) { .bottom-grid { grid-template-columns: 1fr; } }
        @media (max-width: 992px) {
            .dashboard { grid-template-columns: 1fr; display: flex; flex-direction: column; }
            .sidebar { height: auto; position: relative; border-right: none; border-bottom: 1px solid var(--border-light); padding: 30px 20px; display: flex; flex-direction: column; gap: 25px; z-index: 1; }
            .profile { display: flex; align-items: center; gap: 20px; text-align: left; margin-bottom: 10px; }
            .avatar-wrapper { margin: 0; width: 80px; height: 80px; }
            .profile h2 { font-size: 1.2rem; }
            .streak-pill { top: 15px; left: 15px; font-size: 0.75rem; }
            .sidebar-forms { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
            .main-content { padding: 30px 20px; }
        }
        @media (max-width: 768px) {
            body { padding-bottom: 100px; }
            .main-content { padding: 20px 15px; gap: 20px; }
            .today-earnings { font-size: 3rem; }
            .stats-grid { grid-template-columns: 1fr; gap: 15px; }
            .stat-card { padding: 20px; }
            .panel { padding: 20px; border-radius: 16px; }
            .chart-container { height: 250px; }
            
            .sidebar-forms { display: none; }
            .fab { display: flex; }
            .actions { display: none; }
            .list-item { padding: 18px; }
            
            .toast-container { right: 20px; left: 20px; bottom: 20px; align-items: center; }
            .toast { width: 100%; justify-content: center; animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards, fadeOut 0.4s ease forwards 4s; }
            @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        }
    </style>
</head>
<body>

    <div class="dashboard">
        <aside class="sidebar">
            <div class="profile">
                <div class="avatar-wrapper">
                    <div class="avatar-gift"><i class="fas fa-gift"></i></div>
                    <div class="level-badge" id="levelBadge">Lv. 1</div>
                </div>
                <div>
                    <h2>Olá, BaBi</h2>
                    <span>Gestão de Pedidos e Presentes</span>
                </div>
            </div>

            <div class="sidebar-forms">
                <div class="form-section">
                    <h3><i class="fas fa-box-open"></i> Novo Pedido</h3>
                    <form onsubmit="handleAddTask(event)">
                        <input type="text" id="taskName" placeholder="Ex: Cesta de Chocolate M..." required autocomplete="off">
                        <input type="number" id="taskValue" step="0.01" placeholder="Valor (R$)" required autocomplete="off">
                        <button type="submit" class="btn-theme"><i class="fas fa-plus"></i> Adicionar à Fila</button>
                    </form>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-bullseye"></i> Definir Meta</h3>
                    <form onsubmit="handleAddGoal(event)">
                        <input type="text" id="goalName" placeholder="Ex: Fornecedor de Cestas" required autocomplete="off">
                        <input type="number" id="goalValue" step="0.01" placeholder="Valor Alvo (R$)" required autocomplete="off">
                        <button type="submit" class="btn-outline"><i class="fas fa-flag"></i> Estabelecer Meta</button>
                    </form>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-calendar-alt"></i> Agendar Evento</h3>
                    <form onsubmit="handleAddEvent(event)">
                        <input type="text" id="eventName" placeholder="Data comemorativa / Entrega" required autocomplete="off">
                        <input type="date" id="eventDate" required>
                        <button type="submit" class="btn-dark"><i class="far fa-calendar-check"></i> Agendar</button>
                    </form>
                </div>
            </div>
        </aside>

        <main class="main-content">
            
            <div class="today-panel">
                <div class="streak-pill" id="streakBadge"><i class="fas fa-fire"></i> 0 dias de foco</div>
                <div class="today-title">Vendas de Hoje</div>
                <h1 class="today-earnings" id="todayEarningsAnim">R$ 0,00</h1>
                <div class="today-tasks" id="todayCount">0 pedidos entregues</div>
                
                <div class="daily-progress">
                    <div class="daily-fill" id="dailyFill"></div>
                </div>
                <div class="daily-labels">
                    <span>Meta Diária</span>
                    <span id="dailyPctText">0% (R$ 300)</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon-box icon-theme"><i class="fas fa-wallet"></i></div>
                    <div class="stat-info"><span>Ganhos do Mês</span><h3 id="displayEarnings">R$ 0,00</h3></div>
                </div>
                <div class="stat-card">
                    <div class="icon-box icon-green"><i class="fas fa-check-square"></i></div>
                    <div class="stat-info"><span>Entregues no Mês</span><h3 id="displayCompleted">0</h3></div>
                </div>
                <div class="stat-card">
                    <div class="icon-box icon-blue"><i class="fas fa-trophy"></i></div>
                    <div class="stat-info"><span>Meta Atingida</span><h3 id="displayGoalPct">0%</h3></div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h3>Evolução de Faturamento</h3>
                    <p>Análise de performance dos últimos 6 meses</p>
                </div>
                <div class="chart-container"><canvas id="revenueChart"></canvas></div>
            </div>

            <div class="bottom-grid">
                <div class="panel" style="padding: 20px;">
                    <div class="panel-header" style="margin-bottom: 15px;">
                        <h3 style="display: flex; justify-content: space-between; width: 100%;">
                            <span><i class="fas fa-bolt" style="color: var(--primary);"></i> Fila de Pedidos</span>
                            <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: 500;">(Maior valor 1º)</span>
                        </h3>
                        <p style="font-size: 0.8rem; display: block; margin-top: 5px;">No celular: deslize o pedido para <span style="color:var(--success)">Concluir</span> ou <span style="color:var(--danger)">Excluir</span>.</p>
                    </div>
                    <div class="list" id="taskList"></div>
                </div>

                <div class="widgets-column">
                    <div class="panel">
                        <div class="panel-header" style="margin-bottom: 15px;">
                            <h3><i class="fas fa-flag" style="color: var(--text-main);"></i> Metas Ativas</h3>
                        </div>
                        <ul class="list" id="goalList"></ul>
                    </div>
                    <div class="panel">
                        <div class="panel-header" style="margin-bottom: 15px;">
                            <h3><i class="far fa-calendar-check" style="color: var(--text-main);"></i> Próximos Eventos</h3>
                        </div>
                        <ul class="list" id="eventList"></ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <button class="fab" onclick="openQuickAdd()"><i class="fas fa-plus"></i></button>
    <div class="modal-overlay" id="quickAddOverlay" onclick="closeQuickAdd()"></div>
    <div class="bottom-sheet" id="quickAddSheet">
        <h3 style="margin-bottom: 15px; font-size: 1.1rem; color: white;">Adicionar Pedido</h3>
        <div class="smart-input-container">
            <input type="text" id="smartInput" class="smart-input" placeholder="Ex: Cesta Casal 250" autocomplete="off" onkeypress="if(event.key==='Enter') processSmartInput()">
            <i class="fas fa-arrow-up submit-icon" onclick="processSmartInput()"></i>
        </div>
        <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 10px; text-align: center;">O sistema separa o nome e o valor automaticamente.</p>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 25px; font-size: 1.3rem;"><i class="fas fa-pen" style="color: var(--primary); margin-right: 10px;"></i> Editar Pedido</h3>
            <form id="formEdit" onsubmit="saveEditedTask(event)">
                <input type="hidden" id="editTaskId">
                <label style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 5px; display: block;">Nome do Pedido / Cesta</label>
                <input type="text" id="editTaskName" required autocomplete="off">
                <label style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 5px; margin-top: 10px; display: block;">Valor (R$)</label>
                <input type="number" id="editTaskValue" step="0.01" required autocomplete="off">
                <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                    <button type="submit" class="btn-theme" style="flex: 1; min-width: 140px;">Salvar Alterações</button>
                    <button type="button" class="btn-dark" style="flex: 1; min-width: 100px;" onclick="closeEditModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="toast-container" id="toastBox"></div>

    <script>
        // Registra Service Worker para funcionar como App Offline
        if ("serviceWorker" in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register("sw.js").catch(err => console.log(err)); }); }

        // Mudei o nome do banco de dados local para não conflitar com o seu
        let appState = JSON.parse(localStorage.getItem('babi_presentes_v1')) || { tasks: [], goals: [], events: [], streak: 0, lastActiveDate: null, dailyGoal: 300 };

        function saveData() { localStorage.setItem('babi_presentes_v1', JSON.stringify(appState)); renderAll(); }
        function isToday(dStr) { if(!dStr) return false; const d = new Date(dStr); const t = new Date(); return d.getDate() === t.getDate() && d.getMonth() === t.getMonth() && d.getFullYear() === t.getFullYear(); }

        function hapticFeedback(pattern) { if ("vibrate" in navigator) try { navigator.vibrate(pattern); } catch(e) {} }
        
        function showToast(message, type = 'success') {
            const box = document.getElementById('toastBox'); const t = document.createElement('div'); t.className = 'toast';
            let icon = 'fa-check-circle'; let color = 'var(--primary)';
            if(type === 'error') { icon = 'fa-exclamation-circle'; color = 'var(--danger)'; t.style.borderLeftColor = color; }
            if(type === 'info') { icon = 'fa-info-circle'; color = 'var(--info)'; t.style.borderLeftColor = color; }
            t.innerHTML = `<i class="fas ${icon}" style="color: ${color}; font-size: 1.2rem;"></i> <span>${message}</span>`;
            box.appendChild(t); setTimeout(() => t.remove(), 4000);
        }

        function openQuickAdd() { hapticFeedback(10); document.getElementById('quickAddSheet').classList.add('active'); document.getElementById('quickAddOverlay').classList.add('active'); setTimeout(() => document.getElementById('smartInput').focus(), 100); }
        function closeQuickAdd() { document.getElementById('quickAddSheet').classList.remove('active'); document.getElementById('quickAddOverlay').classList.remove('active'); document.getElementById('smartInput').value = ''; }

        function processSmartInput() {
            const raw = document.getElementById('smartInput').value.trim(); if(!raw) return;
            const match = raw.match(/^(.*?)\s+(\d+(?:[.,]\d+)?)$/);
            let name = raw, value = 0;
            if (match) { name = match[1].trim(); value = parseFloat(match[2].replace(',', '.')); }
            appState.tasks.push({ id: Date.now(), name, value, status: 'Pendente', createdAt: new Date().toISOString(), completedAt: null });
            saveData(); hapticFeedback([10,20,10]); showToast('Pedido adicionado!'); closeQuickAdd();
        }

        // Swipe (Gestos)
        function attachGestures(wrapper, card, id) {
            let startX = 0, currentX = 0, holdTimer, isSwiping = false;
            card.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX; isSwiping = false; card.style.transition = 'none';
                holdTimer = setTimeout(() => { if(!isSwiping) { hapticFeedback([10,20,10]); openEditModal(id); } }, 600);
            }, {passive: true});

            card.addEventListener('touchmove', e => {
                const diffX = e.touches[0].clientX - startX;
                if (Math.abs(diffX) > 10) {
                    isSwiping = true; clearTimeout(holdTimer); currentX = diffX;
                    if(currentX > 0) currentX = Math.min(currentX, window.innerWidth * 0.4);
                    if(currentX < 0) currentX = Math.max(currentX, -window.innerWidth * 0.4);
                    card.style.transform = `translateX(${currentX}px)`;
                } else clearTimeout(holdTimer);
            }, {passive: true});

            card.addEventListener('touchend', e => {
                clearTimeout(holdTimer); card.style.transition = 'transform 0.3s ease';
                if (currentX > 80) {
                    hapticFeedback([20, 50, 20]); card.parentElement.classList.add('completing');
                    setTimeout(() => completeTask(id), 300);
                } else if (currentX < -80) {
                    hapticFeedback([50]); card.style.transform = `translateX(-100vw)`;
                    setTimeout(() => deleteTask(id), 300);
                } else card.style.transform = 'translateX(0)';
                currentX = 0;
            });
        }

        // Funções de CRUD
        function handleAddTask(e) { e.preventDefault(); const name = document.getElementById('taskName').value; const value = parseFloat(document.getElementById('taskValue').value); appState.tasks.push({ id: Date.now(), name, value, status: 'Pendente', createdAt: new Date().toISOString(), completedAt: null }); document.getElementById('formTask').reset(); saveData(); showToast('Pedido na fila!'); }
        
        function completeTask(id) {
            const task = appState.tasks.find(t => t.id === id);
            if(task) {
                task.status = 'Concluída'; task.completedAt = new Date().toISOString();
                const todayStr = new Date().toDateString();
                if (appState.lastActiveDate !== todayStr) {
                    const yesterdayStr = new Date(Date.now() - 86400000).toDateString();
                    if(appState.lastActiveDate === yesterdayStr) appState.streak++; else appState.streak = 1;
                    appState.lastActiveDate = todayStr;
                }
                saveData(); showToast('Maravilha! Pedido entregue.', 'success');
            }
        }
        function deleteTask(id) { appState.tasks = appState.tasks.filter(t => t.id !== id); saveData(); showToast('Pedido removido.', 'info'); }
        
        function openEditModal(id) { const task = appState.tasks.find(t => t.id === id); if(task) { document.getElementById('editTaskId').value = task.id; document.getElementById('editTaskName').value = task.name; document.getElementById('editTaskValue').value = task.value; document.getElementById('editModal').classList.add('active'); } }
        function closeEditModal() { document.getElementById('editModal').classList.remove('active'); }
        function saveEditedTask(e) { e.preventDefault(); const id = parseInt(document.getElementById('editTaskId').value); const task = appState.tasks.find(t => t.id === id); if(task) { task.name = document.getElementById('editTaskName').value; task.value = parseFloat(document.getElementById('editTaskValue').value); closeEditModal(); saveData(); showToast('Pedido atualizado!'); } }

        function handleAddGoal(e) { e.preventDefault(); appState.goals.push({ id: Date.now(), name: document.getElementById('goalName').value, value: parseFloat(document.getElementById('goalValue').value) }); document.getElementById('formGoal').reset(); saveData(); showToast('Nova meta definida!'); }
        function deleteGoal(id) { appState.goals = appState.goals.filter(g => g.id !== id); saveData(); }
        function handleAddEvent(e) { e.preventDefault(); const dateInput = document.getElementById('eventDate').value; const [year, month, day] = dateInput.split('-'); appState.events.push({ id: Date.now(), name: document.getElementById('eventName').value, date: `${day}/${month}/${year}`, rawDate: dateInput }); appState.events.sort((a, b) => new Date(a.rawDate) - new Date(b.rawDate)); document.getElementById('formEvent').reset(); saveData(); showToast('Data agendada!'); }
        function deleteEvent(id) { appState.events = appState.events.filter(ev => ev.id !== id); saveData(); }

        // Animação Contagem
        let currentDisplayedEarnings = 0;
        function animateGain(target) {
            const el = document.getElementById("todayEarningsAnim");
            if(currentDisplayedEarnings === target) return;
            let current = currentDisplayedEarnings; let increment = Math.max((target - current) / 30, 1);
            function update() {
                current += increment; if(current >= target) current = target;
                el.innerText = "R$ " + Math.floor(current).toLocaleString('pt-BR');
                if(current < target) requestAnimationFrame(update); else currentDisplayedEarnings = target;
            }
            update();
        }

        // Motor Gráfico e Render
        function formatMoney(value) { return value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
        let revenueChartInstance = null;

        function renderAll() {
            const listTasks = document.getElementById('taskList'); const listGoals = document.getElementById('goalList'); const listEvents = document.getElementById('eventList');
            listTasks.innerHTML = ''; listGoals.innerHTML = ''; listEvents.innerHTML = '';

            const currentMonthStr = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`;
            let totalMonth = 0, totalMonthCount = 0, totalToday = 0, todayCount = 0;

            const pending = appState.tasks.filter(t => t.status === 'Pendente').sort((a, b) => b.value - a.value);
            const completed = appState.tasks.filter(t => t.status === 'Concluída');

            pending.forEach((task, index) => {
                const w = document.createElement('div'); w.className = 'swipe-wrapper'; w.style.marginBottom = '12px';
                w.innerHTML = `
                    <div class="swipe-bg left"><i class="fas fa-check"></i></div>
                    <div class="swipe-bg right"><i class="fas fa-trash"></i></div>
                    <div class="list-item" style="margin-bottom:0;">
                        <div class="task-info">
                            <strong>${task.name}</strong>
                            <div class="task-meta"><div class="status-dot"></div><span>Aguardando</span><span style="margin:0 5px;">&bull;</span><span class="task-value">R$ ${formatMoney(task.value)}</span></div>
                        </div>
                        <div class="actions">
                            <button class="btn-icon check" onclick="completeTask(${task.id})"><i class="fas fa-check"></i></button>
                            <button class="btn-icon" onclick="openEditModal(${task.id})"><i class="fas fa-pen"></i></button>
                            <button class="btn-icon delete" onclick="deleteTask(${task.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                listTasks.appendChild(w);
                attachGestures(w, w.querySelector('.list-item'), task.id);
            });

            completed.forEach(task => {
                if(task.completedAt && task.completedAt.startsWith(currentMonthStr)) { totalMonth += task.value; totalMonthCount++; }
                if(isToday(task.completedAt)) { totalToday += task.value; todayCount++; }
                const w = document.createElement('div'); w.className = 'list-item'; w.style.opacity = '0.4'; w.style.marginBottom = '12px';
                w.innerHTML = `<div class="task-info"><strong style="text-decoration:line-through;">${task.name}</strong></div><div class="task-value" style="color:var(--success);"><i class="fas fa-check"></i></div>`;
                listTasks.appendChild(w);
            });

            if(pending.length === 0 && completed.length === 0) listTasks.innerHTML = `<p style="color:var(--text-muted); text-align:center; padding:20px;">Nenhum pedido na fila.</p>`;

            let totalGoalTarget = 0;
            appState.goals.forEach(goal => {
                totalGoalTarget += goal.value; const pct = Math.min((totalMonth / goal.value) * 100, 100).toFixed(0);
                const li = document.createElement('li'); li.className = 'list-item goal-item';
                li.innerHTML = `<div class="goal-header"><div class="goal-header-text"><strong>${goal.name}</strong><span style="color:var(--primary); font-size:0.85rem; font-weight:700;">R$ ${formatMoney(goal.value)}</span></div><button class="btn-icon delete" onclick="deleteGoal(${goal.id})"><i class="fas fa-times"></i></button></div><div class="goal-progress-bg"><div class="goal-progress-fill" style="width: ${isNaN(pct)?0:pct}%;"></div></div>`;
                listGoals.appendChild(li);
            });

            appState.events.forEach(ev => {
                const li = document.createElement('li'); li.className = 'list-item';
                li.innerHTML = `<div class="goal-header-text"><strong style="display:block; font-size:0.95rem; margin-bottom:5px;">${ev.name}</strong><span style="color:var(--text-muted); font-size:0.8rem;"><i class="far fa-clock"></i> ${ev.date}</span></div><div class="actions"><button class="btn-icon delete" onclick="deleteEvent(${ev.id})"><i class="fas fa-times"></i></button></div>`;
                listEvents.appendChild(li);
            });

            animateGain(totalToday);
            document.getElementById('todayCount').innerText = `${todayCount} pedidos entregues`;
            document.getElementById('streakBadge').innerHTML = `<i class="fas fa-fire"></i> ${appState.streak} dias de fluxo`;
            
            const dailyPct = Math.min((totalToday / appState.dailyGoal) * 100, 100);
            document.getElementById('dailyFill').style.width = `${dailyPct}%`;
            document.getElementById('dailyPctText').innerText = `${Math.floor(dailyPct)}% (R$ ${appState.dailyGoal})`;

            const goalPercentage = totalGoalTarget > 0 ? Math.min(Math.floor((totalMonth / totalGoalTarget) * 100), 100) : 0;
            document.getElementById('displayEarnings').innerText = `R$ ${formatMoney(totalMonth)}`;
            document.getElementById('displayCompleted').innerText = totalMonthCount;
            document.getElementById('displayGoalPct').innerText = `${goalPercentage}%`;

            const badge = document.getElementById('levelBadge');
            if (goalPercentage >= 100 && totalGoalTarget > 0) { badge.innerText = "Lv. MAX"; badge.style.background = "var(--success)"; badge.style.color = "#2a0813"; } 
            else if (goalPercentage >= 50) { badge.innerText = "Lv. 2"; badge.style.background = "var(--primary)"; } 
            else { badge.innerText = "Lv. 1"; badge.style.background = "var(--primary)"; }

            updateChart();
        }

        function updateChart() {
            const monthsNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const labels = []; const dataPts = []; const now = new Date();
            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                labels.push(`${monthsNames[d.getMonth()]} ${d.getFullYear()}`);
                let monthSum = 0;
                appState.tasks.forEach(task => { if(task.status === 'Concluída' && task.completedAt && task.completedAt.startsWith(monthKey)) { monthSum += task.value; } });
                dataPts.push(monthSum);
            }

            const ctx = document.getElementById('revenueChart').getContext('2d');
            let gradient = ctx.createLinearGradient(0, 0, 0, 350);
            gradient.addColorStop(0, 'rgba(244, 114, 182, 0.4)'); gradient.addColorStop(1, 'rgba(244, 114, 182, 0.0)');

            if (revenueChartInstance) {
                revenueChartInstance.data.labels = labels; revenueChartInstance.data.datasets[0].data = dataPts; revenueChartInstance.update();
            } else {
                revenueChartInstance = new Chart(ctx, {
                    type: 'line', data: { labels: labels, datasets: [{ label: 'Faturamento', data: dataPts, borderColor: '#f472b6', backgroundColor: gradient, borderWidth: 3, pointBackgroundColor: '#4a1224', pointBorderColor: '#f472b6', pointBorderWidth: 3, pointRadius: 5, pointHoverRadius: 8, fill: true, tension: 0.4 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: 'rgba(244,114,182,0.05)', drawBorder: false }, ticks: { color: '#fbcfe8', font: {family: 'Inter'} }, beginAtZero: true }, x: { grid: { display: false }, ticks: { color: '#fbcfe8', font: {family: 'Inter'} } } }, interaction: { intersect: false, mode: 'index' } }
                });
            }
        }

        renderAll();
    </script>
</body>
</html>